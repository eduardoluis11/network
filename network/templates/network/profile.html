<!-- This is the user profile page -->

{% extends "network/layout.html" %}
{% load static %}

{% block body %}

    <!-- If the user exists, I will render their username as the title of the page -->
    {% if error_message == 'Error: That username does not exist.' %}

        <!-- This displays an error message if the username doesn't exist -->
        <p style="color: red;"><b>{{error_message}}</b></p>

    {% else %}
        <h1>{{username}}'s Profile Page</h1>
        <br>
        <br>

        <!-- This displays the number of followers of the user from the profile, and how many people that
        user is following -->
        <p>{{number_of_followers}} Followers</p>
        <p>{{number_of_people_that_user_follows}} Following</p>

        <!-- "Follow" button.

        It's better to assign it an ID rather than a class, since I will only show this button
        in the profile page.

        But, to avoid any bugs, I will add code to prevent the user from following themselves. I will add an extra
        condition that says that if the logged user is different to the user in the profile page, to display the
        “follow” button. I could do that directly in the profile.html file by using Jinja notation. I can access the
        username from the logged user using “user.username”. And, I’m already sending via Jinja a variable called
        “username”, which stores the name of the user of the profile page. So, if both “user.username” and “username”
        are different, and if a user is logged, I will render the “Follow” button.

        BUG: For some reason, the “if” statement in profile.html is telling me that “username” is different from
        “user.username”, even though both things show the exact same text. Let me see if I can turn both into strings.
        (FIXED.)

        As for toggling the button between “follow” and “unfollow”, I will use JS code, and either a querySelector or
        a getElementByID. I will use the querySelector to check the word being printed on that button (I may convert
        that value into a string using str() to avoid bugs.) If the word being obtained is “follow”, I will change
        that button into “unfollow” if the user clicks on it (or a “submit” is being sent,) and vice-versa.

        Just like there is an event listener called “onClick()” in HTML, there’s also one called “onsubmit()” (source:
        https://www.w3schools.com/tags/ev_onsubmit.asp .) So, I will add an “onsubmit” attribute to the button in
        profile.html to call the appropriate JS function when I click on it.

        To avoid errors in React, I need to use only IDs to make the JS calls, not classes (source: Anastasiia Solop's
        reply on https://stackoverflow.com/questions/64097973/uncaught-error-minified-react-error-200 .

        If I submit an input, the entire page will reload. So, I will re-do the buttons as <button> tags, and I will
        delete the <input> tags. Also, they will be activated with an onClick(), NOT with an onsubmit. That’s so I
        don’t reload the entire page when I click on the “Follow/Unfollow” button.

        I will put the button outside of the React div. The React div will be empty, and won’t render anything until
        the user clicks on the “follow” button. Then, if the user clicks on the button, one of 2 things will happen
        with an “if” statement: 1) I will get the original button, delete it, and rebuild it, but this time, it will
        display the word “unfollow”. 2) The same as the previous condition, but I will render the word “follow”.

        -->
        {% if user.is_authenticated and is_follow_active == True %}

            <!-- Follow/Unfollow button -->
            <button id="follow_or_unfollow" class="btn btn-primary" onClick="updateFollowState()">
                {{follow_button_text}}
            </button>

            <!-- This div will execute React code -->
            <!-- <div id="follow_unfollow_container"></div> -->

            <!-- DEBUG message -->
<!--            <p>{{username}}</p>-->
<!--            <p>{{user.username}}</p>-->

            <!-- I will modify the button using React -->
<!--            {% if is_user_following_profile == False %}-->

<!--                &lt;!&ndash; This renders the "Follow" button &ndash;&gt;-->
<!--                <div id="follow_button"></div>-->


<!--                <div>-->
<!--                    <button id="follow_or_unfollow" type="submit" class="btn btn-primary"-->
<!--                            onClick="Follow_button_test()">-->
<!--                        Follow-->
<!--                    </button>-->
<!--                </div>-->
<!--            {% else %}-->

<!--                &lt;!&ndash; This renders the "Unfollow" button &ndash;&gt;-->
<!--                <div id="unfollow_button"></div>-->


<!--&lt;!&ndash;                <div id="follow_or_unfollow_div">&ndash;&gt;-->
<!--&lt;!&ndash;                    <button id="follow_or_unfollow" type="submit" class="btn btn-primary"&ndash;&gt;-->
<!--&lt;!&ndash;                            onClick="Follow_button_test()">&ndash;&gt;-->
<!--&lt;!&ndash;                        Unfollow&ndash;&gt;-->
<!--&lt;!&ndash;                    </button>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--            {% endif %}-->

            <!-- DEBUG msg: React test  -->
<!--            <div id="follow_or_unfollow_div"></div>-->

            <!-- DEBUG message: This will show me the value of is_user_following_profile -->
            <p>Am I following this person?: <b>{{is_user_following_profile}}</b></p>

            <!-- DEBUG message: This shows me the value of the Query Set statement that checks if a user is
            following the person in the profile -->
<!--            <p><b>{{is_user_following_query_set}}</b></p>-->
<!--            <p><b>{{is_user_following_query_set.0}}</b></p>-->
<!--            <p><b>{{is_user_following_query_set.0.follower}}</b></p>-->
<!--            <p><b>{{is_user_following_query_set.0.follows}}</b></p>-->

            <!-- <button id="follow_or_unfollow" class="btn btn-primary">Follow</button> -->
        {% endif %}

        <br>
        <br>

        <!-- This displays all the posts from the user in reverse chronological order. I’ll put a title that says
        something like “Posts” above the profile’s posts. -->
        <h5><b>{{username}}'s Posts</b></h5>
        {% for post in all_posts_from_user %}
            <div class="card mb-3">
                <a href="/profile/{{post.user}}"><b>{{post.user}}</b></a>
                <p>Edit</p>
                <p>{{post.body}}</p>
                <p>{{post.timestamp}}</p>
                <p>❤ {{post.number_of_likes}}</p>
                <br>
            </div>
        {% endfor %}

    {% endif %}


{% endblock %}